apiVersion: batch/v1
kind: Job
metadata:
  name: load-test
spec:
  template:
    spec:
      restartPolicy: OnFailure
      containers:
      - name: k6
        image: grafana/k6:0.49.0
        volumeMounts:
        - name: config-volume
          mountPath: /config
        command:
        - k6
        - run
        - /config/script.js
      volumes:
      - name: config-volume
        configMap:
          name: k6-config
  backoffLimit: 0
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: k6-config
data:
  script.js: |
    import http from 'k6/http';
    import { sleep } from 'k6';

    export const options = {
      vus: 10,
      duration: '600s', 
    };
    
    export default function() {
      http.get('http://sample-app/generate-load');
      sleep(1);
    }
    